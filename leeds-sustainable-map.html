<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Leeds Sustainable Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />

  <style>
    html, body {
      height: 100%;
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    #map {
      height: 100%;
      width: 100%;
    }

    .sidebar {
      position: absolute;
      top: 12px;
      left: 12px;
      z-index: 1000;
      background: rgba(255, 255, 255, 0.95);
      padding: 12px 14px;
      border-radius: 12px;
      box-shadow: 0 4px 14px rgba(0, 0, 0, 0.2);
      max-width: 280px;
      font-size: 13px;
    }

    .sidebar h1 {
      font-size: 16px;
      margin: 0 0 4px;
    }

    .sidebar small {
      display: block;
      margin-bottom: 8px;
      color: #555;
    }

    .category-list {
      max-height: 260px;
      overflow-y: auto;
      margin-bottom: 8px;
    }

    .category-item {
      display: flex;
      align-items: center;
      margin-bottom: 4px;
      gap: 6px;
    }

    .category-color {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      flex-shrink: 0;
    }

    .sidebar-footer {
      font-size: 11px;
      color: #777;
      border-top: 1px solid #eee;
      padding-top: 6px;
    }

    .badge-pill {
      display: inline-block;
      background: #eef3ff;
      border-radius: 999px;
      padding: 2px 8px;
      margin: 2px 2px 0 0;
      font-size: 11px;
      color: #334;
      border: 1px solid #d5defa;
    }

    /* å³å´åº—å®¶åˆ—è¡¨ */
    .right-panel {
      position: absolute;
      top: 12px;
      right: 12px;
      z-index: 1000;
      background: rgba(255, 255, 255, 0.95);
      padding: 10px 12px;
      border-radius: 12px;
      box-shadow: 0 4px 14px rgba(0, 0, 0, 0.2);
      width: 280px;
      max-height: calc(100% - 24px);
      display: flex;
      flex-direction: column;
      font-size: 13px;
    }

    .right-panel h2 {
      font-size: 14px;
      margin: 0 0 4px;
    }

    .right-panel small {
      color: #555;
      margin-bottom: 6px;
    }

    .place-list {
      overflow-y: auto;
      padding-right: 4px;
    }

    .place-item {
      padding: 6px 6px;
      border-radius: 8px;
      margin-bottom: 4px;
      cursor: pointer;
      transition: background 0.15s, transform 0.1s;
    }

    .place-item:hover {
      background: #f0f4ff;
      transform: translateY(-1px);
    }

    .place-name {
      font-size: 13px;
      font-weight: 600;
    }

    .place-meta {
      font-size: 11px;
      color: #666;
    }

    .place-stars {
      font-size: 11px;
      color: #f39c12;
    }

    @media (max-width: 900px) {
      .sidebar {
        max-width: 220px;
      }
      .right-panel {
        width: 220px;
      }
    }

    @media (max-width: 640px) {
      .sidebar {
        max-width: calc(100% - 24px);
        right: 12px;
      }
      .right-panel {
        bottom: 12px;
        top: auto;
        width: calc(100% - 24px);
        max-height: 40%;
      }
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <!-- å·¦ä¸Šè§’ç¯©é¸é¢æ¿ -->
  <div class="sidebar">
    <h1>Leeds Sustainable Map ğŸŒ</h1>
    <small>é»é¸åˆ†é¡åˆ‡æ›é¡¯ç¤º / éš±è—åº—å®¶</small>

    <div class="category-list" id="category-list"></div>

    <div class="sidebar-footer">
      ğŸ’¡ é»é¸åœ°åœ–ä¸Šçš„æ¨™è¨˜å¯æŸ¥çœ‹ï¼š<br />
      åº—å®¶åç¨±ã€æ°¸çºŒæ˜Ÿç´šã€Badgesã€ç°¡çŸ­èªªæ˜ã€‚
    </div>
  </div>

  <!-- å³å´åº—å®¶åˆ—è¡¨ -->
  <div class="right-panel">
    <h2>æ°¸çºŒåº—å®¶åˆ—è¡¨ ğŸ—ºï¸</h2>
    <small>é»åº—åï¼Œåœ°åœ–æœƒç§»å‹•ä¸¦æ‰“é–‹è©³ç´°è³‡è¨Š</small>
    <div class="place-list" id="place-list"></div>
  </div>

  <!-- Leaflet JS -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <script>
    // 8 å¤§åˆ†é¡çš„æ¨£å¼èˆ‡é¡è‰²
    const categoryStyles = {
      "Zero Waste / Refill": {
        color: "#2ecc71",
        emoji: "â™»",
        label: "Zero Waste / Refill"
      },
      "Vegan / Plant-based": {
        color: "#27ae60",
        emoji: "ğŸŒ¿",
        label: "Vegan / Plant-based"
      },
      "Vintage / Second-hand": {
        color: "#9b59b6",
        emoji: "ğŸ‘š",
        label: "Vintage / Second-hand"
      },
      "Local & Ethical Food": {
        color: "#e67e22",
        emoji: "ğŸŒ±",
        label: "Local & Ethical Food"
      },
      "Social Enterprise": {
        color: "#16a085",
        emoji: "ğŸ’š",
        label: "Social Enterprise"
      },
      "Repair / Reuse": {
        color: "#3498db",
        emoji: "ğŸ”§",
        label: "Repair / Reuse"
      },
      "BYO Cup / Low-waste": {
        color: "#f1c40f",
        emoji: "â˜•",
        label: "BYO Cup / Low-waste"
      },
      "Urban Farming / Community Garden": {
        color: "#95a5a6",
        emoji: "ğŸ¡",
        label: "Urban Farming / Community"
      }
    };

    // æ°¸çºŒåº—å®¶è³‡æ–™ï¼ˆåº§æ¨™ç‚ºå¤§è‡´å€åŸŸï¼Œå¯ä¹‹å¾Œå¾®èª¿ï¼‰
    const places = [
      // 1) Zero Waste / Refill
      {
        name: "Jar Refill Shop",
        category: "Zero Waste / Refill",
        coords: [53.819, -1.583], // Headingley approx
        level: 5,
        badges: ["Refill", "Zero waste", "Local sourcing"],
        description:
          "å…¨é‡ŒèŒ²æœ€çŸ¥åçš„ refill shopï¼Œæä¾›ç©€ç‰©ã€æ¸…æ½”ç”¨å“èˆ‡æ—¥ç”¨å“è£œå……ã€‚"
      },
      {
        name: "Waste Not",
        category: "Zero Waste / Refill",
        coords: [53.812, -1.568], // Hyde Park approx
        level: 4,
        badges: ["Reuse", "Second-hand", "Social enterprise", "Waste reduction"],
        description:
          "å¿—å·¥é‹ä½œçš„æ¸›å»¢ç©ºé–“ï¼Œæä¾›äºŒæ‰‹ç‰©è³‡èˆ‡ä½åƒ¹æ°¸çºŒç”¢å“ã€‚"
      },
      {
        name: "The Good Fillers",
        category: "Zero Waste / Refill",
        coords: [53.796, -1.540], // Corn Exchange / city centre approx
        level: 3,
        badges: ["Refill", "Eco products"],
        description:
          "æä¾›ç’°ä¿å®¶åº­ç”¨å“ã€è‚¥çš‚ã€æ¸…æ½”åŠ‘è£œå……çš„ refill é»ã€‚"
      },

      // 2) Vegan / Plant-based
      {
        name: "Humpit Hummus",
        category: "Vegan / Plant-based",
        coords: [53.796, -1.540], // Corn Exchange / Call Lane approx
        level: 4,
        badges: ["Vegan", "Low-carbon food"],
        description:
          "ç´”ç´ é·¹å˜´è±†ä¸»é¡Œé¤å»³ï¼Œæ˜¯å­¸ç”Ÿå¾ˆæ„›çš„å¹³åƒ¹ vegan é¸æ“‡ã€‚"
      },
      {
        name: "Fat Annieâ€™s (Kirkgate Market)",
        category: "Vegan / Plant-based",
        coords: [53.796, -1.537], // Kirkgate Market approx
        level: 4,
        badges: ["Plant-based", "Low-carbon food", "Transformation"],
        description:
          "å¾å‚³çµ±ç†±ç‹—æ”¤è½‰å‹ç‚º 100% plant-based çš„ä»£è¡¨æ¡ˆä¾‹ã€‚"
      },
      {
        name: "Cantina Vegan",
        category: "Vegan / Plant-based",
        coords: [53.796, -1.540], // Call Lane area approx
        level: 4,
        badges: ["Vegan", "Local sourcing"],
        description:
          "å‰µæ–°ç´”ç´ é¤é»ï¼Œä¸¦èˆ‡æœ¬åœ°ä¾›æ‡‰å•†åˆä½œã€‚"
      },
      {
        name: "Eat Your Greens",
        category: "Vegan / Plant-based",
        coords: [53.797, -1.535], // New York St approx
        level: 4,
        badges: ["Local sourcing", "Seasonal", "Low-carbon food"],
        description: "farm-to-table é¤å»³ï¼Œä»¥åœ¨åœ°èˆ‡ç•¶å­£é£Ÿæç‚ºä¸»ã€‚"
      },

      // 3) Vintage / Second-hand
      {
        name: "Blue Rinse Vintage",
        category: "Vintage / Second-hand",
        coords: [53.797, -1.540], // Call Lane approx
        level: 5,
        badges: ["Second-hand", "Circular fashion", "Reuse"],
        description: "é‡ŒèŒ²æœ€çŸ¥åçš„ vintage åº—ï¼Œå¼·èª¿æœé£¾å†åˆ©ç”¨ã€‚"
      },
      {
        name: "Cow Vintage",
        category: "Vintage / Second-hand",
        coords: [53.800, -1.540], // New Briggate approx
        level: 4,
        badges: ["Second-hand", "Circular fashion"],
        description: "è‹±åœ‹é€£é–äºŒæ‰‹æ½®æµæœé£¾å“ç‰Œã€‚"
      },
      {
        name: "Makemake",
        category: "Vintage / Second-hand",
        coords: [53.796, -1.540], // Corn Exchange approx
        level: 4,
        badges: ["Second-hand", "Ethical fashion"],
        description: "å°å‹è¨­è¨ˆå¸«èˆ‡äºŒæ‰‹ç²¾å“æ··åˆé¸å“åº—ã€‚"
      },
      {
        name: "Leeds Community Clothes Exchange",
        category: "Vintage / Second-hand",
        coords: [53.812, -1.568], // Hyde Park approx
        level: 5,
        badges: ["Reuse", "Community", "Second-hand"],
        description: "ä»¥è¡£ç‰©äº¤æ›ç‚ºä¸»çš„æ´»å‹•ï¼Œå¼·çƒˆæ¨å»£å¾ªç’°æ¶ˆè²»ã€‚"
      },

      // 4) Repair / Reuse
      {
        name: "Leeds Repair CafÃ©",
        category: "Repair / Reuse",
        coords: [53.819, -1.583], // Headingley (pop-up)
        level: 5,
        badges: ["Repair", "Community", "Waste reduction"],
        description: "å¿—å·¥å¹«å¿™ä¿®ç†é›»å™¨ã€å®¶å…·èˆ‡è¡£ç‰©çš„ç¤¾å€è¡Œå‹•ã€‚"
      },
      {
        name: "Seagulls Paint",
        category: "Repair / Reuse",
        coords: [53.815, -1.604], // Kirkstall approx
        level: 5,
        badges: ["Reuse", "Social enterprise", "Art sustainability", "Education"],
        description: "å›æ”¶æ²¹æ¼†å†è£½èˆ‡è—è¡“æ•™è‚²å·¥ä½œåŠçš„ç¤¾æœƒä¼æ¥­ã€‚"
      },
      {
        name: "Revive Leeds â€“ Reuse Shop",
        category: "Repair / Reuse",
        coords: [53.812, -1.461], // Seacroft approx
        level: 4,
        badges: ["Reuse", "Second-hand", "Community"],
        description: "å®¶å…·ã€å®¶ç”¨å“å†è²©å”®ï¼Œèˆ‡æ…ˆå–„åˆä½œçš„ reuse shopã€‚"
      },

      // 5) Local & Ethical Food
      {
        name: "Out of This World",
        category: "Local & Ethical Food",
        coords: [53.797, -1.544], // New Market St approx
        level: 5,
        badges: ["Local sourcing", "Ethical sourcing", "Fair trade", "Organic"],
        description: "æœ¬åœ°ã€æœ‰æ©Ÿèˆ‡å…¬å¹³è²¿æ˜“é£Ÿå“èˆ‡ç”Ÿæ´»ç”¨å“é›œè²¨åº—ã€‚"
      },
      {
        name: "Kirkgate Market Local Farmers Stalls",
        category: "Local & Ethical Food",
        coords: [53.796, -1.537],
        level: 4,
        badges: ["Local farmers", "Low food miles", "Seasonal"],
        description: "æ”¯æŒåœ¨åœ°è¾²å ´ã€æ¸›å°‘é£Ÿç‰©é‡Œç¨‹çš„å°è¾²æ”¤ä½ã€‚"
      },
      {
        name: "North Star Coffee Roasters (Roastery & CafÃ©)",
        category: "Local & Ethical Food",
        coords: [53.791, -1.532], // Leeds Dock approx
        level: 4,
        badges: ["Ethical sourcing", "Local roasting", "BYO cup"],
        description: "é€æ˜é“å¾·æ¡è³¼èˆ‡åœ¨åœ°çƒ˜ç„™çš„ç‰¹è‰²å’–å•¡å“ç‰Œã€‚"
      },

      // 6) Social Enterprise
      {
        name: "The Green Yard",
        category: "Social Enterprise",
        coords: [53.830, -1.568], // Meanwood approx
        level: 5,
        badges: ["Urban green", "Community", "Education", "Social enterprise"],
        description: "ç¤¾å€åœ’è—ã€å…±äº«èŠ±åœ’èˆ‡æ°¸çºŒæ•™è‚²ç©ºé–“ã€‚"
      },
      {
        name: "The Real Junk Food Project",
        category: "Social Enterprise",
        coords: [53.797, -1.543], // use city centre approx (å¤šæ“šé»)
        level: 5,
        badges: [
          "Food waste reduction",
          "Social equity",
          "Pay as you feel",
          "Community"
        ],
        description:
          "åˆ©ç”¨å‰©é£Ÿä¾›é¤çš„ã€ŒPay as You Feelã€æ¨¡å¼ç¤¾æœƒä¼æ¥­ï¼ˆå¤šæ“šé»ï¼‰ã€‚"
      },
      {
        name: "Rainbow Junktion",
        category: "Social Enterprise",
        coords: [53.812, -1.568], // Hyde Park approx
        level: 4,
        badges: ["Food waste reduction", "Social enterprise", "Community"],
        description: "å‰©é£Ÿé£Ÿå ‚èˆ‡ç¤¾å€è¡Œå‹•ç©ºé–“ã€‚"
      },

      // 7) BYO Cup / Low-waste Friendly
      {
        name: "Laynes Espresso",
        category: "BYO Cup / Low-waste",
        coords: [53.795, -1.548], // near station
        level: 4,
        badges: ["BYO cup", "Compostable packaging", "Local sourcing"],
        description: "å¸‚ä¸­å¿ƒç¨ç«‹å’–å•¡é¤¨ï¼Œæä¾›è‡ªå¸¶æ¯æŠ˜æ‰£èˆ‡ä½å»¢æ£„å¤–å¸¶æ¯ã€‚"
      },
      {
        name: "North Star Coffee Roasters (CafÃ©)",
        category: "BYO Cup / Low-waste",
        coords: [53.791, -1.532], // Leeds Dock
        level: 4,
        badges: ["BYO cup", "Ethical sourcing", "Local roasting"],
        description: "çµåˆé“å¾·æ¡è³¼èˆ‡æœ¬åœ°çƒ˜ç„™çš„è‡ªå¸¶æ¯å‹å–„å’–å•¡é¤¨ã€‚"
      },
      {
        name: "Opposite CafÃ©",
        category: "BYO Cup / Low-waste",
        coords: [53.819, -1.583], // Headingley approx
        level: 4,
        badges: ["BYO cup", "Local sourcing"],
        description: "å­¸ç”Ÿèˆ‡åœ¨åœ°å±…æ°‘å¸¸å»çš„å’–å•¡é¤¨ï¼Œé¼“å‹µè‡ªå¸¶æ¯ã€‚"
      },
      {
        name: "House of Koko",
        category: "BYO Cup / Low-waste",
        coords: [53.827, -1.537], // Chapel Allerton approx
        level: 4,
        badges: ["BYO cup", "Local sourcing", "Community"],
        description: "ç¤¾å€å‹å’–å•¡é¤¨ï¼Œå‹å–„è‡ªå¸¶æ¯ä¸¦æ”¯æŒæœ¬åœ°ä¾›æ‡‰å•†ã€‚"
      },

      // 8) Urban Farming & Community Gardens
      {
        name: "Hyde Park Source",
        category: "Urban Farming / Community Garden",
        coords: [53.812, -1.568], // Hyde Park approx
        level: 5,
        badges: ["Urban farming", "Community", "Education", "Green space"],
        description: "é‡ŒèŒ²æœ€å¼·çš„ç¤¾å€ç’°å¢ƒèˆ‡åœ’è—æ•™è‚²çµ„ç¹”ä¹‹ä¸€ã€‚"
      },
      {
        name: "Incredible Edible Leeds",
        category: "Urban Farming / Community Garden",
        coords: [53.797, -1.543], // various sites, use centre
        level: 4,
        badges: ["Urban food", "Community", "Free produce"],
        description: "å…è²»è”¬èœç®±èˆ‡ç¤¾å€è¾²è€•è¨ˆç•«ï¼Œæ“šé»éå¸ƒ Leedsã€‚"
      }
    ];

    // åˆå§‹åŒ–åœ°åœ–
    const map = L.map("map").setView([53.8, -1.55], 12);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 19,
      attribution: "&copy; OpenStreetMap contributors"
    }).addTo(map);

    // ç‚ºæ¯å€‹åˆ†é¡å»ºç«‹ LayerGroup
    const categoryLayers = {};
    Object.keys(categoryStyles).forEach((cat) => {
      categoryLayers[cat] = L.layerGroup().addTo(map);
    });

    // å„²å­˜ markerï¼Œæ–¹ä¾¿å³å´åˆ—è¡¨é»é¸æ™‚ä½¿ç”¨
    const markers = [];

    // å°‡æ•¸å­—æ˜Ÿç´šè½‰æˆ â­ å­—ä¸²
    function starString(level) {
      return "â­".repeat(level);
    }

    // å»ºç«‹ Marker ä¸¦åŠ å…¥å„è‡ªçš„ Layer
    places.forEach((place) => {
      const style = categoryStyles[place.category];

      const marker = L.circleMarker(place.coords, {
        radius: 9,
        color: style.color,
        weight: 2,
        fillColor: style.color,
        fillOpacity: 0.7
      });

      const badgeHtml =
        place.badges && place.badges.length
          ? `<div>${place.badges
              .map((b) => `<span class="badge-pill">${b}</span>`)
              .join("")}</div>`
          : "";

      const popupHtml = `
        <div>
          <strong>${style.emoji} ${place.name}</strong><br/>
          <small>${place.category}</small><br/>
          <div class="place-stars">æ°¸çºŒå¼·åº¦ï¼š${starString(place.level)} (${place.level}/5)</div>
          ${badgeHtml}
          <p style="margin-top:4px;margin-bottom:0;">${place.description}</p>
        </div>
      `;

      marker.bindPopup(popupHtml);
      marker.addTo(categoryLayers[place.category]);
      markers.push(marker);
    });

    // å»ºç«‹å´é‚Šæ¬„ä¸­çš„åˆ†é¡å‹¾é¸æ¡†
    const categoryListEl = document.getElementById("category-list");

    Object.entries(categoryStyles).forEach(([catKey, style]) => {
      const id = `cat-${catKey.replace(/\W+/g, "-")}`;

      const wrapper = document.createElement("div");
      wrapper.className = "category-item";

      const colorDot = document.createElement("span");
      colorDot.className = "category-color";
      colorDot.style.backgroundColor = style.color;

      const checkbox = document.createElement("input");
      checkbox.type = "checkbox";
      checkbox.id = id;
      checkbox.checked = true;
      checkbox.dataset.category = catKey;
      checkbox.className = "category-filter";

      const label = document.createElement("label");
      label.setAttribute("for", id);
      label.textContent = `${style.emoji} ${style.label}`;

      wrapper.appendChild(checkbox);
      wrapper.appendChild(colorDot);
      wrapper.appendChild(label);

      categoryListEl.appendChild(wrapper);
    });

    // å‹¾é¸åˆ†é¡æ™‚ï¼Œé¡¯ç¤º / éš±è—è©² LayerGroup
    function updateCategoryVisibility() {
      document.querySelectorAll(".category-filter").forEach((cb) => {
        const category = cb.dataset.category;
        const layer = categoryLayers[category];
        if (!layer) return;

        if (cb.checked) {
          if (!map.hasLayer(layer)) {
            layer.addTo(map);
          }
        } else {
          if (map.hasLayer(layer)) {
            map.removeLayer(layer);
          }
        }
      });
    }

    document
      .querySelectorAll(".category-filter")
      .forEach((cb) => cb.addEventListener("change", updateCategoryVisibility));

    // å³å´åº—å®¶åˆ—è¡¨ï¼šé»äº†ä¹‹å¾Œåœ°åœ–ç§»å‹• + é–‹ popup
    const placeListEl = document.getElementById("place-list");

    places.forEach((place, index) => {
      const style = categoryStyles[place.category];

      const item = document.createElement("div");
      item.className = "place-item";

      const nameEl = document.createElement("div");
      nameEl.className = "place-name";
      nameEl.textContent = `${style.emoji} ${place.name}`;

      const metaEl = document.createElement("div");
      metaEl.className = "place-meta";
      metaEl.textContent = `${place.category}`;

      const starsEl = document.createElement("div");
      starsEl.className = "place-stars";
      starsEl.textContent = starString(place.level);

      item.appendChild(nameEl);
      item.appendChild(metaEl);
      item.appendChild(starsEl);

      // é»é¸æ™‚ï¼šç§»å‹•åˆ°è©²åº—å®¶ä¸¦é–‹å•Ÿ popup
      item.addEventListener("click", () => {
        const marker = markers[index];
        if (!marker) return;
        const coords = place.coords;

        map.setView(coords, 15, { animate: true });
        marker.openPopup();
      });

      placeListEl.appendChild(item);
    });
  </script>
</body>
</html>
